version: "3"

tasks:
  env:
    desc: Generate an updated .env file
    cmds:
      - rm -rf application/.env .env
      - echo "# this file is autogenerated, go to .infrastructure/environment to edit" >> .env
      - cat .infrastructure/environment/docker.env >> .env
      - echo "# this file is autogenerated, go to .infrastructure/environment to edit" >> application/.env
      - cat .infrastructure/environment/docker.env .infrastructure/environment/app.env >> application/.env
      - cd application && php artisan key:generate

  purge:
    desc: Stop all docker containers and nuke them
    cmds:
      - task: stop
      - spin prune

  start:
    desc: Start docker
    cmds:
      - spin up --build --detach

  stop:
    desc: Stop the container
    cmds:
      - spin down
