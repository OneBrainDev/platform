version: "3"

tasks:
   env:
      desc: Generate an updated .env file
      cmds:
         - rm -rf application/.env frontend/web/.env
         - cat  .env >> application/.env
         - echo "# this file is autogenerated, edit the primary .env file at the project root" >> frontend/web/.env
         - cat .env >> frontend/web/.env
         - cd application && php artisan key:generate

   env-init:
      desc: Generate an updated .env file
      cmds:
         - rm -rf application/.env .env frontend/web/.env
         - cat .env.example >> .env
         - echo "# this file is autogenerated, edit the primary .env file at the project root" >> application/.env
         - cat  .env >> application/.env
         - echo "# this file is autogenerated, edit the primary .env file at the project root" >> frontend/web/.env
         - cat .env >> frontend/web/.env
         - cd application && php artisan key:generate

   purge:
      desc: Stop all docker containers and nuke them
      cmds:
         - task: stop
         - spin prune

   start:
      desc: Start docker
      cmds:
         - spin up --build --detach

   start-nodetach:
      desc: Start docker without detaching it
      cmds:
         - spin up --build

   stop:
      desc: Stop the container
      cmds:
         - spin down

   restart:
      desc: Stop and restart all containers
      cmds:
         - task: stop
         - task: start

   refresh:
      desc: Stop, clear containers and start the container back up
      cmds:
         - task: purge
         - task: start
